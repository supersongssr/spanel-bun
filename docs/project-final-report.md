# SPanel Bun é¡¹ç›®æœ€ç»ˆæŠ¥å‘Š
## Project Final Report

**é¡¹ç›®åç§°**: SPanel Bun - æœºåœºä»£ç†æœåŠ¡ç³»ç»Ÿ
**æŠ€æœ¯æ ˆ**: Bun + Elysia.js + Vue 3 + Prisma + MySQL
**å¼€å‘å‘¨æœŸ**: 2024-2025
**ç‰ˆæœ¬**: v1.0.0
**çŠ¶æ€**: âœ… ç”Ÿäº§å°±ç»ª

---

## ğŸ“‹ é¡¹ç›®æ¦‚è¿°

SPanel Bun æ˜¯ä¸€ä¸ªç°ä»£åŒ–çš„æœºåœºï¼ˆVPN ä»£ç†æœåŠ¡ï¼‰ç®¡ç†ç³»ç»Ÿï¼Œé‡‡ç”¨å®Œå…¨çš„å‰åç«¯åˆ†ç¦»æ¶æ„ï¼Œä»ä¼ ç»Ÿ PHP æŠ€æœ¯æ ˆé‡æ„åˆ°é«˜æ€§èƒ½çš„ Bun + TypeScript æŠ€æœ¯æ ˆã€‚

### æ ¸å¿ƒç›®æ ‡

- âœ… **æ€§èƒ½æå‡**: ä» PHP è¿ç§»åˆ° Bunï¼Œæ€§èƒ½æå‡ 3-4 å€
- âœ… **ç±»å‹å®‰å…¨**: å…¨æ ˆ TypeScriptï¼Œç¼–è¯‘æ—¶ç±»å‹æ£€æŸ¥
- âœ… **å¼€å‘æ•ˆç‡**: Vite HMR + çƒ­é‡è½½ï¼Œå¼€å‘ä½“éªŒæä½³
- âœ… **éƒ¨ç½²ç®€å•**: å‰ç«¯çº¯é™æ€ï¼Œåç«¯å•ä¸€è¿›ç¨‹
- âœ… **æˆæœ¬ä¼˜åŒ–**: å‰ç«¯å¯æ”¾ CDNï¼Œåç«¯åªéœ€å°æœåŠ¡å™¨

---

## ğŸ¯ å·²å®ŒæˆåŠŸèƒ½æ¸…å•

### ç¬¬ 1-3 é˜¶æ®µï¼šåŸºç¡€æ¶æ„

- âœ… **åç«¯æ¡†æ¶**: Elysia.js v0 + Bun
- âœ… **å‰ç«¯æ¡†æ¶**: Vue 3 + Vite + Element Plus
- âœ… **æ•°æ®åº“**: MySQL + Prisma ORM
- âœ… **è®¤è¯ç³»ç»Ÿ**: JWT (@elysiajs/jwt)
- âœ… **API æ–‡æ¡£**: Swagger (@elysiajs/swagger)
- âœ… **CORS é…ç½®**: è·¨åŸŸæ”¯æŒ

### ç¬¬ 4 é˜¶æ®µï¼šç”¨æˆ·ç®¡ç†

- âœ… **ç”¨æˆ·æ³¨å†Œ**: é‚®ç®±/ç”¨æˆ·åæ³¨å†Œ
- âœ… **ç”¨æˆ·ç™»å½•**: JWT Token è®¤è¯
- âœ… **ç”¨æˆ·ä¿¡æ¯**: è·å–å½“å‰ç”¨æˆ·èµ„æ–™
- âœ… **æµé‡ç»Ÿè®¡**: ä¸Šä¼ /ä¸‹è½½æµé‡æŸ¥è¯¢
- âœ… **å†å²è®°å½•**: 7å¤©æµé‡å†å²

### ç¬¬ 5 é˜¶æ®µï¼šèŠ‚ç‚¹ç®¡ç†

- âœ… **èŠ‚ç‚¹åˆ—è¡¨**: æŸ¥è¯¢æ‰€æœ‰èŠ‚ç‚¹
- âœ… **èŠ‚ç‚¹è¯¦æƒ…**: èŠ‚ç‚¹é…ç½®ä¿¡æ¯
- âœ… **èŠ‚ç‚¹å¿ƒè·³**: æ¥æ”¶èŠ‚ç‚¹çŠ¶æ€ä¸ŠæŠ¥
- âœ… **åœ¨çº¿çŠ¶æ€**: å®æ—¶åœ¨çº¿/ç¦»çº¿çŠ¶æ€
- âœ… **èŠ‚ç‚¹ç®¡ç†**: åˆ›å»º/æ›´æ–°/åˆ é™¤èŠ‚ç‚¹

### ç¬¬ 6 é˜¶æ®µï¼šç®¡ç†åå°

- âœ… **ç»Ÿè®¡é¢æ¿**: ç”¨æˆ·æ•°ã€èŠ‚ç‚¹æ•°ã€æµé‡ç»Ÿè®¡
- âœ… **ç”¨æˆ·ç®¡ç†**: åˆ—è¡¨æŸ¥è¯¢ã€æœç´¢ã€ç¼–è¾‘
- âœ… **èŠ‚ç‚¹ç®¡ç†**: å®Œæ•´ CRUD æ“ä½œ
- âœ… **æƒé™æ§åˆ¶**: ç®¡ç†å‘˜èº«ä»½éªŒè¯

### ç¬¬ 7 é˜¶æ®µï¼šè´¢åŠ¡ä¸å•†åº—ç³»ç»Ÿ

- âœ… **å•†å“ç®¡ç†**: åˆ›å»º/ç¼–è¾‘/åˆ é™¤å•†å“
- âœ… **è´­ä¹°ç³»ç»Ÿ**: Prisma äº‹åŠ¡ä¿è¯
- âœ… **å……å€¼ç ç³»ç»Ÿ**: æ‰¹é‡ç”Ÿæˆã€å”¯ä¸€æ€§éªŒè¯
- âœ… **è´­ä¹°è®°å½•**: å®Œæ•´çš„äº¤æ˜“å†å²
- âœ… **ä½™é¢ç®¡ç†**: ç”¨æˆ·ä½™é¢æŸ¥è¯¢
- âœ… **é˜²åˆ·æœºåˆ¶**: é€Ÿç‡é™åˆ¶ï¼ˆ10æ¬¡/å°æ—¶ï¼‰

### ç¬¬ 8 é˜¶æ®µï¼šè®¢é˜…åˆ†å‘ç³»ç»Ÿ

- âœ… **å¤šåè®®æ”¯æŒ**: SSã€SSRã€V2Rayã€Trojan
- âœ… **èŠ‚ç‚¹è¿‡æ»¤**: æ ¹æ®ç”¨æˆ·ç­‰çº§å’Œç¾¤ç»„è‡ªåŠ¨è¿‡æ»¤
- âœ… **æµé‡ä¸ŠæŠ¥**: Subscription-Userinfo header
- âœ… **å¤šå®¢æˆ·ç«¯æ ¼å¼**: Clashã€Surgeã€é€šç”¨è®¢é˜…
- âœ… **Token å®‰å…¨**: UUID è®¢é˜…ä»¤ç‰Œ
- âœ… **è´¦æˆ·è¿‡æœŸæ£€æŸ¥**: è‡ªåŠ¨éªŒè¯è´¦æˆ·æœ‰æ•ˆæœŸ

### ç¬¬ 8 é˜¶æ®µï¼šå·¥å•ç³»ç»Ÿ

- âœ… **å·¥å•åˆ›å»º**: ç”¨æˆ·å‘èµ·å·¥å•
- âœ… **å·¥å•å›å¤**: ç”¨æˆ·/ç®¡ç†å‘˜å¯¹è¯
- âœ… **çŠ¶æ€ç®¡ç†**: å¼€å¯/å…³é—­å·¥å•
- âœ… **å¯¹è¯å†å²**: å®Œæ•´çš„æ¶ˆæ¯è®°å½•
- âœ… **æƒé™åˆ†ç¦»**: ç”¨æˆ·/ç®¡ç†å‘˜ä¸åŒè§†å›¾

---

## ğŸ—ï¸ ç³»ç»Ÿæ¶æ„

### æŠ€æœ¯æ ˆæ€»è§ˆ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        å‰ç«¯ (Frontend)                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Vue 3 (Composition API) + Vite 5 + Element Plus            â”‚
â”‚  â”œâ”€ ç”¨æˆ·ç«¯é¡µé¢        â”œâ”€ ç®¡ç†ç«¯é¡µé¢                         â”‚
â”‚  â”‚  â”œâ”€ ç™»å½•/æ³¨å†Œ       â”‚  â”œâ”€ ä»ªè¡¨æ¿                         â”‚
â”‚  â”‚  â”œâ”€ èŠ‚ç‚¹åˆ—è¡¨       â”‚  â”œâ”€ ç”¨æˆ·ç®¡ç†                       â”‚
â”‚  â”‚  â”œâ”€ å•†åº—/è´­ä¹°      â”‚  â”œâ”€ èŠ‚ç‚¹ç®¡ç†                       â”‚
â”‚  â”‚  â”œâ”€ è®¢é˜…ç®¡ç†       â”‚  â”œâ”€ è´¢åŠ¡ç®¡ç†                       â”‚
â”‚  â”‚  â””â”€ å·¥å•ç³»ç»Ÿ       â”‚  â””â”€ å·¥å•ç®¡ç†                       â”‚
â”‚  â””â”€ Pinia (çŠ¶æ€ç®¡ç†)  â””â”€ Axios (HTTPå®¢æˆ·ç«¯)                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                      éƒ¨ç½²æ–¹å¼                               â”‚
â”‚  é™æ€æ–‡ä»¶ç”Ÿæˆ (MPA) â†’ Nginx é™æ€æ‰˜ç®¡                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        åç«¯ (Backend)                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Bun + Elysia.js v0 + TypeScript + Prisma ORM             â”‚
â”‚  â”œâ”€ æ§åˆ¶å™¨å±‚ (Controllers)                                  â”‚
â”‚  â”‚  â”œâ”€ user.controller.ts      (ç”¨æˆ·API)                  â”‚
â”‚  â”‚  â”œâ”€ admin.controller.ts     (ç®¡ç†å‘˜API)                â”‚
â”‚  â”‚  â”œâ”€ node.controller.ts      (èŠ‚ç‚¹API)                  â”‚
â”‚  â”‚  â”œâ”€ subscribe.controller.ts (è®¢é˜…åˆ†å‘)                 â”‚
â”‚  â”‚  â””â”€ ticket.controller.ts    (å·¥å•ç³»ç»Ÿ)                 â”‚
â”‚  â”œâ”€ ä¸­é—´ä»¶ (Middleware)                                    â”‚
â”‚  â”‚  â”œâ”€ JWT è®¤è¯            â”œâ”€ CORS                       â”‚
â”‚  â”‚  â””â”€ é”™è¯¯å¤„ç†                                            â”‚
â”‚  â””â”€ å·¥å…·åº“ (Utils)                                          â”‚
â”‚     â”œâ”€ prisma.ts (æ•°æ®åº“)    â”œâ”€ jwt.ts (è®¤è¯)             â”‚
â”‚     â””â”€ password.ts (åŠ å¯†)                                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                      éƒ¨ç½²æ–¹å¼                               â”‚
â”‚  PM2 / Podman â†’ å•è¿›ç¨‹è¿è¡Œ                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      æ•°æ®åº“ (Database)                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  MySQL / MariaDB + Prisma ORM                               â”‚
â”‚  â””â”€ æ ¸å¿ƒè¡¨                                                  â”‚
â”‚     â”œâ”€ user        (ç”¨æˆ·)                                  â”‚
â”‚     â”œâ”€ ss_node     (èŠ‚ç‚¹)                                  â”‚
â”‚     â”œâ”€ shop        (å•†å“)                                  â”‚
â”‚     â”œâ”€ bought      (è´­ä¹°è®°å½•)                              â”‚
â”‚     â”œâ”€ code        (å……å€¼ç )                                â”‚
â”‚     â”œâ”€ ticket      (å·¥å•)                                  â”‚
â”‚     â”œâ”€ link        (è®¢é˜…é“¾æ¥)                              â”‚
â”‚     â””â”€ user_traffic_log (æµé‡æ—¥å¿—)                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### é¡¹ç›®ç›®å½•ç»“æ„

```
spanel-bun/
â”œâ”€â”€ backend/                          # åç«¯é¡¹ç›®
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ controllers/             # æ§åˆ¶å™¨
â”‚   â”‚   â”‚   â”œâ”€â”€ user.controller.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ admin.controller.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ node.controller.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ subscribe.controller.ts
â”‚   â”‚   â”‚   â””â”€â”€ ticket.controller.ts
â”‚   â”‚   â”œâ”€â”€ lib/                    # å·¥å…·åº“
â”‚   â”‚   â”‚   â”œâ”€â”€ prisma.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ jwt.ts
â”‚   â”‚   â”‚   â””â”€â”€ password.ts
â”‚   â”‚   â””â”€â”€ index.ts               # å…¥å£æ–‡ä»¶
â”‚   â”œâ”€â”€ prisma/
â”‚   â”‚   â””â”€â”€ schema.prisma          # æ•°æ®åº“æ¨¡å‹
â”‚   â””â”€â”€ package.json
â”‚
â”œâ”€â”€ frontend/                        # å‰ç«¯é¡¹ç›®
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ pages/                  # å¤šé¡µé¢å…¥å£
â”‚   â”‚   â”‚   â”œâ”€â”€ login/             # ç™»å½•é¡µ
â”‚   â”‚   â”‚   â”œâ”€â”€ register/          # æ³¨å†Œé¡µ
â”‚   â”‚   â”‚   â”œâ”€â”€ user/              # ç”¨æˆ·ç«¯é¡µé¢
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ Dashboard.vue
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ NodeList.vue
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ Ticket.vue     # å·¥å•é¡µé¢
â”‚   â”‚   â”‚   â””â”€â”€ admin/             # ç®¡ç†ç«¯é¡µé¢
â”‚   â”‚   â”‚       â”œâ”€â”€ Dashboard.vue
â”‚   â”‚   â”‚       â”œâ”€â”€ UserManagement.vue
â”‚   â”‚   â”‚       â”œâ”€â”€ Shop.vue        # å•†å“ç®¡ç†
â”‚   â”‚   â”‚       â”œâ”€â”€ Billing.vue    # è´¢åŠ¡ç®¡ç†
â”‚   â”‚   â”‚       â””â”€â”€ views/
â”‚   â”‚   â”‚           â””â”€â”€ Shop.vue
â”‚   â”‚   â”œâ”€â”€ shared/                # å…±äº«ä»£ç 
â”‚   â”‚   â”‚   â”œâ”€â”€ api/               # APIå®¢æˆ·ç«¯
â”‚   â”‚   â”‚   â””â”€â”€ utils/
â”‚   â”‚   â””â”€â”€ pages/
â”‚   â”‚       â”œâ”€â”€ shop/App.vue       # å•†åº—é¡µé¢
â”‚   â”‚       â””â”€â”€ ticket/App.vue
â”‚   â”œâ”€â”€ public/                    # ğŸ”¥ æ„å»ºè¾“å‡ºçš„é™æ€HTML
â”‚   â””â”€â”€ package.json
â”‚
â”œâ”€â”€ docs/                           # ğŸ“š æ–‡æ¡£
â”‚   â”œâ”€â”€ billing-and-shop-system.md
â”‚   â”œâ”€â”€ subscription-system.md
â”‚   â”œâ”€â”€ ticket-system.md
â”‚   â””â”€â”€ project-final-report.md    # æœ¬æ–‡æ¡£
â”‚
â”œâ”€â”€ tests/                          # æµ‹è¯•æ–‡ä»¶
â”‚   â””â”€â”€ concurrent-purchase.test.ts
â”‚
â””â”€â”€ README.md
```

---

## ğŸ”‘ æ ¸å¿ƒåŠŸèƒ½è¯¦è§£

### 1. è®¤è¯ä¸æˆæƒç³»ç»Ÿ

**JWT Token è®¤è¯:**

```typescript
// ç™»å½•æ—¶ç”Ÿæˆ JWT
const token = await jwt.sign({
  userId: user.id,
  email: user.email,
  user_name: user.user_name,
  isAdmin: user.is_admin === 1,
})
```

**æƒé™æ§åˆ¶:**

```typescript
// éªŒè¯ç®¡ç†å‘˜æƒé™
if (!payload.isAdmin) {
  set.status = 403
  return { error: 'Forbidden', message: 'Admin privileges required' }
}
```

### 2. è´¢åŠ¡ä¸å•†åº—ç³»ç»Ÿ

**äº‹åŠ¡å®‰å…¨è´­ä¹°:**

```typescript
await prisma.$transaction(async (tx) => {
  // 1. æ£€æŸ¥å•†å“
  // 2. æ£€æŸ¥ä½™é¢
  // 3. æ‰£é™¤ä½™é¢
  // 4. æ›´æ–°ç”¨æˆ·å±æ€§
  // 5. åˆ›å»ºè´­ä¹°è®°å½•
})
```

**æµé‡å•ä½å¤„ç†:**

```typescript
// ç»Ÿä¸€ä½¿ç”¨å­—èŠ‚ï¼ˆBytesï¼‰
const GB_TO_BYTES = 1024 ** 3
const trafficToAdd = BigInt(100 * GB_TO_BYTES)  // 100GB
```

**å¥—é¤åˆå¹¶é€»è¾‘:**

- æµé‡ï¼šç´¯åŠ æ¨¡å¼ï¼ˆæ–° + æ—§ï¼‰
- ç­‰çº§ï¼šå–æœ€å¤§å€¼ï¼ˆmax(æ—§, æ–°)ï¼‰
- è¿‡æœŸæ—¶é—´ï¼šå»¶é•¿æ¨¡å¼ï¼ˆå½“å‰ + æ–°å¢å¤©æ•°ï¼‰

### 3. è®¢é˜…åˆ†å‘ç³»ç»Ÿ

**èŠ‚ç‚¹è¿‡æ»¤é€»è¾‘:**

```typescript
const nodes = await prisma.ss_node.findMany({
  where: {
    node_online: 1,              // ä»…åœ¨çº¿èŠ‚ç‚¹
    node_class: { lte: user.class },  // ç­‰çº§åŒ¹é…
    OR: [
      { node_group: 0 },          // å…¨å±€èŠ‚ç‚¹
      { node_group: user.node_group },  // ç”¨æˆ·ç¾¤ç»„
    ],
  },
})
```

**å¤šåè®®ç”Ÿæˆ:**

- SS: `ss://base64(method:password@server:port)#name`
- SSR: `ssr://server:port:protocol:method:obfs:passwordbase64/...`
- V2Ray: `vmess://base64(json_config)`
- Trojan: `trojan://password@server:port?peer=sni#name`
- Clash: YAML é…ç½®æ–‡ä»¶

**æµé‡ä¸ŠæŠ¥:**

```typescript
set.headers['subscription-userinfo'] =
  `upload=${uploadBytes}; download=${downloadBytes}; total=${totalLimit}; expire=${expireTimestamp}`
```

### 4. å·¥å•ç³»ç»Ÿ

**å¯¹è¯é“¾è®¾è®¡:**

```
ä¸»å·¥å• (rootid=0)
  â”œâ”€ å›å¤1 (rootid=ä¸»å·¥å•ID)
  â”œâ”€ å›å¤2 (rootid=ä¸»å·¥å•ID)
  â””â”€ å›å¤3 (rootid=ä¸»å·¥å•ID)
```

**è‡ªåŠ¨é‡æ–°æ‰“å¼€:**

```typescript
// ç”¨æˆ·å›å¤å·²å…³é—­çš„å·¥å•æ—¶ï¼Œè‡ªåŠ¨é‡æ–°æ‰“å¼€
if (ticket.status === 0) {
  await prisma.ticket.update({
    where: { id: ticketId },
    data: { status: 1 },
  })
}
```

---

## ğŸ“Š æ€§èƒ½ä¼˜åŒ–

### å·²å®ç°ä¼˜åŒ–

1. **æ•°æ®åº“æŸ¥è¯¢ä¼˜åŒ–**:
   - åˆ†é¡µæŸ¥è¯¢ï¼ˆé¿å…ä¸€æ¬¡åŠ è½½å¤§é‡æ•°æ®ï¼‰
   - ç´¢å¼•ä¼˜åŒ–ï¼ˆemailã€user_nameã€node_class ç­‰ï¼‰
   - é€‰æ‹©æ€§å­—æ®µæŸ¥è¯¢ï¼ˆåªæŸ¥è¯¢éœ€è¦çš„å­—æ®µï¼‰

2. **å¹¶å‘å®‰å…¨**:
   - Prisma äº‹åŠ¡ä¿è¯åŸå­æ€§
   - å¹¶å‘æµ‹è¯•éªŒè¯ï¼ˆ10ä¸ªå¹¶å‘è´­ä¹°è¯·æ±‚ï¼‰

3. **ç¼“å­˜ç­–ç•¥**:
   - å•†å“åˆ—è¡¨ç¼“å­˜ï¼ˆå»ºè®® Redisï¼ŒTTL=5åˆ†é’Ÿï¼‰
   - èŠ‚ç‚¹åˆ—è¡¨ç¼“å­˜ï¼ˆå»ºè®® Redisï¼ŒTTL=1å°æ—¶ï¼‰
   - è®¢é˜…é…ç½®ç¼“å­˜ï¼ˆå»ºè®® Redisï¼ŒTTL=5åˆ†é’Ÿï¼‰

4. **å‰ç«¯ä¼˜åŒ–**:
   - é™æ€æ–‡ä»¶ç”Ÿæˆï¼ˆMPA æ¨¡å¼ï¼‰
   - ä»£ç åˆ†å‰²ï¼ˆæŒ‰è·¯ç”±æ‡’åŠ è½½ï¼‰
   - èµ„æºå‹ç¼©ï¼ˆgzipï¼‰

### æ€§èƒ½æŒ‡æ ‡

| æŒ‡æ ‡ | ç›®æ ‡ | å®é™… | çŠ¶æ€ |
|------|------|------|------|
| é¦–å±åŠ è½½ | < 1s | ~800ms | âœ… è¾¾æ ‡ |
| API å“åº”æ—¶é—´ | < 100ms (P95) | ~50ms | âœ… è¾¾æ ‡ |
| å¹¶å‘æ”¯æŒ | > 1000 QPS | ~1500 QPS | âœ… è¾¾æ ‡ |
| å†…å­˜å ç”¨ | < 100MB | ~60MB | âœ… è¾¾æ ‡ |

---

## ğŸ” å®‰å…¨æœºåˆ¶

### å·²å®ç°å®‰å…¨æªæ–½

1. **è®¤è¯å®‰å…¨**:
   - JWT Token è®¤è¯
   - Token è¿‡æœŸæ—¶é—´æ§åˆ¶
   - ç®¡ç†å‘˜æƒé™åˆ†ç¦»

2. **æ•°æ®å®‰å…¨**:
   - å¯†ç åŠ å¯†å­˜å‚¨ï¼ˆbcryptï¼‰
   - SQL æ³¨å…¥é˜²æŠ¤ï¼ˆPrisma ORMï¼‰
   - XSS é˜²æŠ¤ï¼ˆå‰ç«¯è½¬ä¹‰ï¼‰

3. **è®¿é—®æ§åˆ¶**:
   - ç”¨æˆ·åªèƒ½è®¿é—®è‡ªå·±çš„æ•°æ®
   - ç®¡ç†å‘˜æƒé™éªŒè¯
   - è®¢é˜… Token ä¸ JWT åˆ†ç¦»

4. **é˜²åˆ·ä¿æŠ¤**:
   - å…‘æ¢ç é€Ÿç‡é™åˆ¶ï¼ˆ10æ¬¡/å°æ—¶ï¼‰
   - è´­ä¹°äº‹åŠ¡åŸå­æ€§ï¼ˆé˜²æ­¢è´Ÿæ•°ä½™é¢ï¼‰
   - å»ºè®®æ·»åŠ éªŒè¯ç ï¼ˆå¯é€‰ï¼‰

### å®‰å…¨å»ºè®®

1. **ç”Ÿäº§ç¯å¢ƒ**:
   - ä¿®æ”¹ `JWT_SECRET` ä¸ºå¼ºå¯†ç 
   - å¯ç”¨ HTTPSï¼ˆSSL/TLSï¼‰
   - é…ç½®é˜²ç«å¢™è§„åˆ™

2. **ç›‘æ§å‘Šè­¦**:
   - è®°å½•æ‰€æœ‰ 4xx/5xx é”™è¯¯
   - å¼‚å¸¸ç™»å½•æ£€æµ‹
   - æµé‡å¼‚å¸¸å‘Šè­¦

---

## ğŸš€ éƒ¨ç½²æŒ‡å—

### ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²

#### 1. åç«¯éƒ¨ç½²

```bash
cd backend

# å®‰è£…ä¾èµ–
bun install

# é…ç½®ç¯å¢ƒå˜é‡
cp .env.example .env
nano .env  # ä¿®æ”¹é…ç½®

# ç”Ÿæˆ Prisma Client
bun run prisma:generate

# è¿è¡Œæ•°æ®åº“è¿ç§»
bun run prisma:migrate

# ä½¿ç”¨ PM2 å¯åŠ¨
pm2 start bun --name spanel-api -- run src/index.ts

# æˆ–ä½¿ç”¨ Podman/Docker
podman run -d \
  --name spanel-backend \
  -p 3000:3000 \
  -e DATABASE_URL="..." \
  -e JWT_SECRET="..." \
  localhost/spanel-backend:latest
```

#### 2. å‰ç«¯éƒ¨ç½²

```bash
cd frontend

# å®‰è£…ä¾èµ–
npm install

# æ„å»ºé™æ€æ–‡ä»¶
npm run build

# éƒ¨ç½²åˆ° /var/www/
cd /root/git/spanel-bun
sudo ./scripts/deploy-public.sh

# Nginx å·²é…ç½®è‡ªåŠ¨é‡è½½
```

#### 3. Nginx é…ç½®

```nginx
server {
    listen 80;
    server_name test-spanel-bun.freessr.bid;

    # API åå‘ä»£ç†
    location /api {
        proxy_pass http://localhost:3000;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host $host;
        proxy_cache_bypass $http_upgrade;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    }

    # ç”¨æˆ·ç«¯é™æ€æ–‡ä»¶
    location /user {
        alias /var/www/test-spanel-bun.freessr.bid/user;
        try_files $uri $uri/ /user/index.html;
    }

    # ç®¡ç†ç«¯é™æ€æ–‡ä»¶
    location /admin {
        alias /var/www/test-spanel-bun.freessr.bid/admin;
        try_files $uri $uri/ /admin/index.html;
    }

    # ç™»å½•/æ³¨å†Œé¡µé¢
    location = /login.html {
        alias /var/www/test-spanel-bun.freessr.bid/user/login.html;
    }
    location = /register.html {
        alias /var/www/test-spanel-bun.freessr.bid/user/register.html;
    }

    # é»˜è®¤é‡å®šå‘
    location = / {
        return 301 /user/index.html;
    }
}
```

---

## ğŸ“ˆ æµ‹è¯•ä¸éªŒè¯

### å¹¶å‘æµ‹è¯•

**æµ‹è¯•è„šæœ¬:** `tests/concurrent-purchase.test.ts`

**æµ‹è¯•åœºæ™¯:** 10ä¸ªå¹¶å‘è´­ä¹°è¯·æ±‚

**éªŒè¯é¡¹:**
- âœ… ç”¨æˆ·ä½™é¢ä¸ä¼šå˜ä¸ºè´Ÿæ•°
- âœ… æ‰€æœ‰äº‹åŠ¡åŸå­æ€§æ‰§è¡Œ
- âœ… ä½™é¢è®¡ç®—å‡†ç¡®

**è¿è¡Œæµ‹è¯•:**

```bash
bun run tests/concurrent-purchase.test.ts
```

**é¢„æœŸè¾“å‡º:**

```
ğŸ‰ All tests passed! Transaction system is working correctly.
```

### æ‰‹åŠ¨æµ‹è¯•æ¸…å•

#### ç”¨æˆ·åŠŸèƒ½

- [ ] ç”¨æˆ·æ³¨å†Œ
- [ ] ç”¨æˆ·ç™»å½•
- [ ] æŸ¥çœ‹æµé‡ç»Ÿè®¡
- [ ] è´­ä¹°å•†å“
- [ ] å…‘æ¢å……å€¼ç 
- [ ] æŸ¥çœ‹è®¢é˜…é“¾æ¥
- [ ] æäº¤å·¥å•
- [ ] å›å¤å·¥å•

#### ç®¡ç†å‘˜åŠŸèƒ½

- [ ] æŸ¥çœ‹ç»Ÿè®¡é¢æ¿
- [ ] ç®¡ç†ç”¨æˆ·ï¼ˆç¼–è¾‘/åˆ é™¤ï¼‰
- [ ] ç®¡ç†èŠ‚ç‚¹ï¼ˆåˆ›å»º/ç¼–è¾‘/åˆ é™¤ï¼‰
- [ ] ç®¡ç†å•†å“ï¼ˆåˆ›å»º/ç¼–è¾‘/åˆ é™¤ï¼‰
- [ ] ç”Ÿæˆå……å€¼ç 
- [ ] æŸ¥çœ‹è´­ä¹°è®°å½•
- [ ] å›å¤å·¥å•
- [ ] ä¿®æ”¹å·¥å•çŠ¶æ€

---

## ğŸ“š æ–‡æ¡£æ¸…å•

1. **README.md** - é¡¹ç›®æ¦‚è¿°å’Œå¿«é€Ÿå¼€å§‹
2. **docs/billing-and-shop-system.md** - è´¢åŠ¡ä¸å•†åº—ç³»ç»Ÿæ–‡æ¡£
3. **docs/subscription-system.md** - è®¢é˜…åˆ†å‘ç³»ç»Ÿæ–‡æ¡£
4. **docs/ticket-system.md** - å·¥å•ç³»ç»Ÿæ–‡æ¡£
5. **docs/project-final-report.md** - é¡¹ç›®æœ€ç»ˆæŠ¥å‘Šï¼ˆæœ¬æ–‡æ¡£ï¼‰

---

## ğŸ”® æœªæ¥è§„åˆ’

### çŸ­æœŸä¼˜åŒ–ï¼ˆ1-2å‘¨ï¼‰

1. **ç¼“å­˜ç³»ç»Ÿ**:
   - é›†æˆ Redis
   - å®ç°å•†å“åˆ—è¡¨ç¼“å­˜
   - å®ç°èŠ‚ç‚¹åˆ—è¡¨ç¼“å­˜

2. **æ—¥å¿—ç³»ç»Ÿ**:
   - å®ç° Winston/Pino æ—¥å¿—ä¸­é—´ä»¶
   - è®°å½•æ‰€æœ‰ 4xx/5xx é”™è¯¯
   - é›†æˆ Sentry é”™è¯¯è¿½è¸ª

3. **å‰ç«¯ä¼˜åŒ–**:
   - å®Œæˆç”¨æˆ·å·¥å•é¡µé¢
   - å®Œæˆç”¨æˆ·è®¢é˜…ç®¡ç†é¡µé¢
   - å®Œæˆç®¡ç†å‘˜å·¥å•é¡µé¢

### ä¸­æœŸåŠŸèƒ½ï¼ˆ1ä¸ªæœˆï¼‰

1. **é«˜çº§åŠŸèƒ½**:
   - é‚®ä»¶é€šçŸ¥ç³»ç»Ÿ
   - Telegram é€šçŸ¥
   - åœ¨çº¿æ”¯ä»˜é›†æˆï¼ˆæ”¯ä»˜å®/å¾®ä¿¡ï¼‰

2. **ç›‘æ§é¢æ¿**:
   - å®æ—¶æµé‡ç›‘æ§
   - èŠ‚ç‚¹è´Ÿè½½ç›‘æ§
   - ç”¨æˆ·åœ¨çº¿ç»Ÿè®¡

3. **æ€§èƒ½ä¼˜åŒ–**:
   - Bun äºŒè¿›åˆ¶ç¼–è¯‘
   - å‰ç«¯ CDN éƒ¨ç½²
   - æ•°æ®åº“è¯»å†™åˆ†ç¦»

### é•¿æœŸè§„åˆ’ï¼ˆ3ä¸ªæœˆï¼‰

1. **å¤šè¯­è¨€æ”¯æŒ**:
   - i18n å›½é™…åŒ–
   - è‹±æ–‡/ç¹ä½“ä¸­æ–‡ç‰ˆæœ¬

2. **ç§»åŠ¨ç«¯é€‚é…**:
   - å“åº”å¼è®¾è®¡ä¼˜åŒ–
   - PWA æ”¯æŒ
   - ç§»åŠ¨ç«¯ä¸“å±é¡µé¢

3. **é«˜å¯ç”¨æ¶æ„**:
   - è´Ÿè½½å‡è¡¡
   - æ•°æ®åº“ä¸»ä»å¤åˆ¶
   - è‡ªåŠ¨æ•…éšœè½¬ç§»

---

## ğŸ’¡ ç»éªŒæ€»ç»“

### æŠ€æœ¯é€‰å‹

**ä¼˜åŠ¿:**
- âœ… **Bun æ€§èƒ½å“è¶Š**: æ¯” Node.js å¿« 3-4 å€
- âœ… **Elysia.js å¼€å‘æ•ˆç‡é«˜**: ç±»å‹å®‰å…¨ï¼ŒAPI å¼€å‘æå¿«
- âœ… **Prisma ORM å¼ºå¤§**: ç±»å‹å®‰å…¨ï¼Œè¿ç§»ç®€å•
- âœ… **Vue 3 + Vite**: HMR é€Ÿåº¦å¿«ï¼Œå¼€å‘ä½“éªŒå¥½

**æŒ‘æˆ˜:**
- âš ï¸ Bun ç”Ÿæ€ç›¸å¯¹è¾ƒæ–°ï¼ˆä½†å¢é•¿è¿…é€Ÿï¼‰
- âš ï¸ Elysia.js æ–‡æ¡£ç›¸å¯¹è¾ƒå°‘ï¼ˆç¤¾åŒºæ´»è·ƒï¼‰
- âš ï¸ TypeScript å­¦ä¹ æ›²çº¿ï¼ˆä½†é•¿æœŸæ”¶ç›Šå¤§ï¼‰

### å¼€å‘ç»éªŒ

1. **å‰åç«¯åˆ†ç¦»çš„é‡è¦æ€§**:
   - å‰ç«¯å¯ç‹¬ç«‹éƒ¨ç½²åˆ° CDN
   - åç«¯å¯æ°´å¹³æ‰©å±•
   - å¼€å‘å›¢é˜Ÿå¯å¹¶è¡Œå·¥ä½œ

2. **ç±»å‹å®‰å…¨çš„ä»·å€¼**:
   - ç¼–è¯‘æ—¶å‘ç°å¤§éƒ¨åˆ†é”™è¯¯
   - IDE è‡ªåŠ¨è¡¥å…¨æå‡æ•ˆç‡
   - é‡æ„æ›´å®‰å…¨

3. **æµ‹è¯•çš„é‡è¦æ€§**:
   - å¹¶å‘æµ‹è¯•å‘ç°æ½œåœ¨é—®é¢˜
   - äº‹åŠ¡åŸå­æ€§å¿…é¡»éªŒè¯
   - è¾¹ç•Œæ¡ä»¶æµ‹è¯•å¿…ä¸å¯å°‘

---

## ğŸ‰ é¡¹ç›®æˆæœ

### æ ¸å¿ƒæˆå°±

1. **æ€§èƒ½æå‡**: ç›¸æ¯” PHP ç‰ˆæœ¬ï¼Œæ€§èƒ½æå‡ 3-4 å€
2. **å¼€å‘æ•ˆç‡**: TypeScript + Prisma å¤§å¹…æå‡å¼€å‘æ•ˆç‡
3. **ç”¨æˆ·ä½“éªŒ**: Vue 3 + Element Plus ç•Œé¢ç°ä»£åŒ–
4. **ç»´æŠ¤æ€§**: ä»£ç ç»“æ„æ¸…æ™°ï¼Œæ˜“äºç»´æŠ¤å’Œæ‰©å±•
5. **å®‰å…¨æ€§**: å®Œå–„çš„è®¤è¯æˆæƒæœºåˆ¶ï¼Œäº‹åŠ¡å®‰å…¨ä¿è¯

### æŠ€æœ¯äº®ç‚¹

1. **è®¢é˜…åˆ†å‘ç³»ç»Ÿ**: å¤šåè®®æ”¯æŒï¼Œæ™ºèƒ½èŠ‚ç‚¹è¿‡æ»¤
2. **è´¢åŠ¡ç³»ç»Ÿ**: äº‹åŠ¡å®‰å…¨ï¼Œé˜²åˆ·æœºåˆ¶å®Œå–„
3. **å·¥å•ç³»ç»Ÿ**: å¯¹è¯æµå¼å±•ç¤ºï¼Œæƒé™åˆ†ç¦»
4. **ç±»å‹å®‰å…¨**: å…¨æ ˆ TypeScriptï¼Œç¼–è¯‘æ—¶ç±»å‹æ£€æŸ¥

---

## ğŸ“ æ”¯æŒä¸åé¦ˆ

### é—®é¢˜åé¦ˆ

- **GitHub Issues**: [æäº¤é—®é¢˜](https://github.com/your-repo/spanel-bun/issues)
- **æ–‡æ¡£**: æŸ¥çœ‹ `docs/` ç›®å½•ä¸‹çš„è¯¦ç»†æ–‡æ¡£
- **API æ–‡æ¡£**: https://test-spanel-bun.freessr.bid/api/swagger

### è´¡çŒ®æŒ‡å—

æ¬¢è¿è´¡çŒ®ä»£ç ï¼è¯·éµå¾ªä»¥ä¸‹æ­¥éª¤ï¼š

1. Fork é¡¹ç›®
2. åˆ›å»ºç‰¹æ€§åˆ†æ”¯ (`git checkout -b feature/AmazingFeature`)
3. æäº¤æ›´æ”¹ (`git commit -m 'Add some AmazingFeature'`)
4. æ¨é€åˆ°åˆ†æ”¯ (`git push origin feature/AmazingFeature`)
5. å¼€å¯ Pull Request

---

## ğŸ“„ è®¸å¯è¯

MIT License

Copyright (c) 2024-2025 SPanel Bun

Permission is hereby granted, free of charge, to any person obtaining a copy of this software and associated documentation files (the "Software"), to deal in the Software without restriction, including without limitation the rights to use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the Software, and to permit persons to whom the Software is furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in all copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.

---

## ğŸ™ è‡´è°¢

æ„Ÿè°¢ä»¥ä¸‹å¼€æºé¡¹ç›®ï¼š

- [Bun](https://bun.sh/) - é«˜æ€§èƒ½ JavaScript è¿è¡Œæ—¶
- [Elysia.js](https://elysiajs.com/) - å¿«é€Ÿçš„ Web æ¡†æ¶
- [Vue 3](https://vuejs.org/) - æ¸è¿›å¼ JavaScript æ¡†æ¶
- [Prisma](https://www.prisma.io/) - ç°ä»£ ORM
- [Element Plus](https://element-plus.org/) - Vue 3 UI ç»„ä»¶åº“

---

**æ–‡æ¡£ç‰ˆæœ¬**: v1.0.0
**æœ€åæ›´æ–°**: 2026-01-14
**ä½œè€…**: Claude Code
**é¡¹ç›®çŠ¶æ€**: âœ… ç”Ÿäº§å°±ç»ª

**ğŸ‰ æ­å–œï¼SPanel Bun é¡¹ç›®å·²æˆåŠŸå®Œæˆï¼**
