var Y=(S,U,g)=>new Promise((C,b)=>{var _=i=>{try{y(g.next(i))}catch(r){b(r)}},w=i=>{try{y(g.throw(i))}catch(r){b(r)}},y=i=>i.done?C(i.value):Promise.resolve(i.value).then(_,w);y((g=g.apply(S,U)).next())});import"../modulepreload-polyfill-B5Qt9EMX.js";import{v as Ve,r as p,c as we,l as ye,ab as s,ac as he,B as T,z as B,C as e,D as t,E as v,Q as u,u as d,R as c,M as xe,y as q,O,at as Ue}from"../vue-vendor-k0iSlyGv.js";/* empty css               */import{u as R,f as Ce,a as ke,s as De,j as Se,r as ze,v as Ie,x as Be,E as F,i as Ee,e as Me}from"../element-plus-0NBP0_0Z.js";import{b as k,j as G,f as Ae,e as D,c as Ye,h as L,i as Q,s as Fe}from"../router-guard-Df7N2WPS.js";import{_ as Ne}from"../_plugin-vue_export-helper-DlAUqK2U.js";const $e={class:"user-management-container"},je={class:"header-content"},He={class:"title"},Pe={class:"user-info"},Te={class:"user-name"},qe={class:"pagination-container"},Oe={class:"form-tip"},Re={class:"form-tip"},Le={class:"form-tip"},Qe={key:0,class:"form-tip warning"},Ge=Ve({__name:"UserManagement",setup(S){const U=p([]),g=p([]),C=p(!1),b=p(""),_=p(1),w=p(20),y=p(0),i=p(!1),r=p(null),o=p({}),E=p(!1),M=p(0),J=we(()=>k.getUserName()||"Admin"),V=()=>Y(this,null,function*(){var n;try{C.value=!0;const l=yield L(Q.api.admin.users.get({query:{page:_.value.toString(),pageSize:w.value.toString(),search:b.value||void 0}}));U.value=l.users,g.value=l.users,y.value=l.pagination.total,console.log(`Loaded ${l.users.length} users, total: ${l.pagination.total}`)}catch(l){console.error("Failed to fetch users:",l),F.error(l.message||"获取用户列表失败"),(n=l.message)!=null&&n.includes("Authentication")&&k.logout()}finally{C.value=!1}}),K=()=>{_.value=1,V()},W=()=>{b.value="",_.value=1,V()},X=n=>{_.value=n,V()},Z=n=>{w.value=n,_.value=1,V()},ee=n=>{r.value=n,o.value={email:n.email,user_name:n.user_name,money:parseFloat(n.money),class:n.class,node_group:n.node_group,transfer_enable:parseInt(n.transfer_enable),u:parseInt(n.used_upload),d:parseInt(n.used_download),expire_in:n.expire_in?new Date(n.expire_in):null,method:n.method,protocol:n.protocol,obfs:n.obfs,is_admin:n.is_admin},i.value=!0},le=()=>{o.value={},r.value=null},ae=()=>Y(this,null,function*(){try{E.value=!0;const n=o.value.expire_in?new Date(o.value.expire_in).toISOString():null,l={email:o.value.email,user_name:o.value.user_name,money:o.value.money,class:o.value.class,node_group:o.value.node_group,transfer_enable:o.value.transfer_enable.toString(),u:o.value.u.toString(),d:o.value.d.toString(),expire_in:n,method:o.value.method,protocol:o.value.protocol,obfs:o.value.obfs,is_admin:o.value.is_admin};yield L(Q.api.admin.users(r.value.id).put({body:l})),F.success("用户信息已更新"),i.value=!1,V()}catch(n){console.error("Failed to update user:",n),F.error(n.message||"更新用户失败")}finally{E.value=!1}}),te=()=>{window.location.href="/admin/index.html"},oe=()=>{k.logout()};return ye(()=>{if(G()){if(!k.isAdmin()){alert("需要管理员权限才能访问此页面"),window.location.href="/index.html";return}M.value=k.getUserId()||0,V()}}),(n,l)=>{var P;const z=s("el-icon"),$=s("el-tag"),h=s("el-button"),ne=s("el-dropdown-item"),se=s("el-dropdown-menu"),de=s("el-dropdown"),ue=s("el-header"),I=s("el-input"),j=s("el-col"),ie=s("el-row"),H=s("el-card"),f=s("el-table-column"),re=s("el-table"),me=s("el-pagination"),pe=s("el-main"),m=s("el-form-item"),x=s("el-input-number"),_e=s("el-date-picker"),A=s("el-option"),fe=s("el-select"),ce=s("el-switch"),ve=s("el-form"),ge=s("el-dialog"),be=he("loading");return B(),T("div",$e,[e(ue,{class:"admin-header"},{default:t(()=>[v("div",je,[v("h1",He,[e(z,null,{default:t(()=>[e(d(R))]),_:1}),l[17]||(l[17]=u(" 用户管理 ",-1))]),v("div",Pe,[e($,{type:"danger",size:"large"},{default:t(()=>[...l[18]||(l[18]=[u("管理员",-1)])]),_:1}),e(h,{onClick:te,icon:d(Ce)},{default:t(()=>[...l[19]||(l[19]=[u("返回",-1)])]),_:1},8,["icon"]),e(de,null,{dropdown:t(()=>[e(se,null,{default:t(()=>[e(ne,{onClick:oe},{default:t(()=>[e(z,null,{default:t(()=>[e(d(De))]),_:1}),l[20]||(l[20]=u(" 退出登录 ",-1))]),_:1})]),_:1})]),default:t(()=>[v("span",Te,[e(z,null,{default:t(()=>[e(d(R))]),_:1}),u(" "+c(J.value)+" ",1),e(z,{class:"el-icon--right"},{default:t(()=>[e(d(ke))]),_:1})])]),_:1})])])]),_:1}),e(pe,{class:"admin-main"},{default:t(()=>[e(H,{class:"filter-card"},{default:t(()=>[e(ie,{gutter:20},{default:t(()=>[e(j,{xs:24,sm:12,md:8},{default:t(()=>[e(I,{modelValue:b.value,"onUpdate:modelValue":l[0]||(l[0]=a=>b.value=a),placeholder:"搜索邮箱或用户名","prefix-icon":d(Se),clearable:"",onChange:K},null,8,["modelValue","prefix-icon"])]),_:1}),e(j,{xs:24,sm:12,md:8},{default:t(()=>[e(h,{type:"primary",onClick:V,icon:d(ze)},{default:t(()=>[...l[21]||(l[21]=[u(" 刷新列表 ",-1)])]),_:1},8,["icon"]),e(h,{onClick:W,icon:d(Ie)},{default:t(()=>[...l[22]||(l[22]=[u(" 重置筛选 ",-1)])]),_:1},8,["icon"])]),_:1})]),_:1})]),_:1}),e(H,{class:"table-card"},{default:t(()=>[xe((B(),q(re,{data:g.value,stripe:"",style:{width:"100%"},"default-sort":{prop:"id",order:"descending"}},{default:t(()=>[e(f,{prop:"id",label:"ID",width:"80",sortable:""}),e(f,{prop:"email",label:"邮箱","min-width":"200"}),e(f,{prop:"user_name",label:"用户名","min-width":"150"}),e(f,{prop:"class",label:"等级",width:"100",align:"center"},{default:t(({row:a})=>[e($,{type:a.is_admin?"danger":"primary",size:"small"},{default:t(()=>[u(c(a.is_admin?"Admin":a.class),1)]),_:2},1032,["type"])]),_:1}),e(f,{prop:"money",label:"余额",width:"120",align:"right"},{default:t(({row:a})=>[u(c(d(Ae)(a.money)),1)]),_:1}),e(f,{prop:"used_total",label:"已用流量",width:"150",align:"right"},{default:t(({row:a})=>[u(c(d(D)(a.used_total)),1)]),_:1}),e(f,{prop:"transfer_enable",label:"流量上限",width:"150",align:"right"},{default:t(({row:a})=>[u(c(d(D)(a.transfer_enable)),1)]),_:1}),e(f,{prop:"expire_in",label:"过期时间",width:"180"},{default:t(({row:a})=>[u(c(d(Ye)(a.expire_in)),1)]),_:1}),e(f,{label:"操作",width:"200",fixed:"right"},{default:t(({row:a})=>[e(h,{type:"primary",size:"small",onClick:Ke=>ee(a),icon:d(Be)},{default:t(()=>[...l[23]||(l[23]=[u(" 编辑 ",-1)])]),_:1},8,["onClick","icon"])]),_:1})]),_:1},8,["data"])),[[be,C.value]]),v("div",qe,[e(me,{"current-page":_.value,"onUpdate:currentPage":l[1]||(l[1]=a=>_.value=a),"page-size":w.value,"onUpdate:pageSize":l[2]||(l[2]=a=>w.value=a),"page-sizes":[20,50,100],total:y.value,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:Z,onCurrentChange:X},null,8,["current-page","page-size","total"])])]),_:1})]),_:1}),e(ge,{modelValue:i.value,"onUpdate:modelValue":l[16]||(l[16]=a=>i.value=a),title:`编辑用户 - ${(P=r.value)==null?void 0:P.user_name}`,width:"600px",onClose:le},{footer:t(()=>[e(h,{onClick:l[15]||(l[15]=a=>i.value=!1)},{default:t(()=>[...l[24]||(l[24]=[u("取消",-1)])]),_:1}),e(h,{type:"primary",onClick:ae,loading:E.value},{default:t(()=>[...l[25]||(l[25]=[u(" 保存 ",-1)])]),_:1},8,["loading"])]),default:t(()=>[r.value?(B(),q(ve,{key:0,model:o.value,"label-width":"120px",ref:"editFormRef"},{default:t(()=>[e(m,{label:"用户 ID"},{default:t(()=>[e(I,{modelValue:r.value.id,"onUpdate:modelValue":l[3]||(l[3]=a=>r.value.id=a),disabled:""},null,8,["modelValue"])]),_:1}),e(m,{label:"邮箱"},{default:t(()=>[e(I,{modelValue:o.value.email,"onUpdate:modelValue":l[4]||(l[4]=a=>o.value.email=a)},null,8,["modelValue"])]),_:1}),e(m,{label:"用户名"},{default:t(()=>[e(I,{modelValue:o.value.user_name,"onUpdate:modelValue":l[5]||(l[5]=a=>o.value.user_name=a)},null,8,["modelValue"])]),_:1}),e(m,{label:"等级"},{default:t(()=>[e(x,{modelValue:o.value.class,"onUpdate:modelValue":l[6]||(l[6]=a=>o.value.class=a),min:0,max:255},null,8,["modelValue"])]),_:1}),e(m,{label:"节点组"},{default:t(()=>[e(x,{modelValue:o.value.node_group,"onUpdate:modelValue":l[7]||(l[7]=a=>o.value.node_group=a),min:0,max:255},null,8,["modelValue"])]),_:1}),e(m,{label:"余额"},{default:t(()=>[e(x,{modelValue:o.value.money,"onUpdate:modelValue":l[8]||(l[8]=a=>o.value.money=a),precision:2,step:1},null,8,["modelValue"])]),_:1}),e(m,{label:"流量上限 (Bytes)"},{default:t(()=>[e(x,{modelValue:o.value.transfer_enable,"onUpdate:modelValue":l[9]||(l[9]=a=>o.value.transfer_enable=a),step:1073741824},null,8,["modelValue"]),v("div",Oe," 当前值: "+c(d(D)(o.value.transfer_enable)),1)]),_:1}),e(m,{label:"上传流量 (Bytes)"},{default:t(()=>[e(x,{modelValue:o.value.u,"onUpdate:modelValue":l[10]||(l[10]=a=>o.value.u=a),min:0},null,8,["modelValue"]),v("div",Re," 当前值: "+c(d(D)(o.value.u)),1)]),_:1}),e(m,{label:"下载流量 (Bytes)"},{default:t(()=>[e(x,{modelValue:o.value.d,"onUpdate:modelValue":l[11]||(l[11]=a=>o.value.d=a),min:0},null,8,["modelValue"]),v("div",Le," 当前值: "+c(d(D)(o.value.d)),1)]),_:1}),e(m,{label:"过期时间"},{default:t(()=>[e(_e,{modelValue:o.value.expire_in,"onUpdate:modelValue":l[12]||(l[12]=a=>o.value.expire_in=a),type:"datetime",placeholder:"选择日期时间",format:"YYYY-MM-DD HH:mm:ss","value-format":"YYYY-MM-DDTHH:mm:ss"},null,8,["modelValue"])]),_:1}),e(m,{label:"加密方式"},{default:t(()=>[e(fe,{modelValue:o.value.method,"onUpdate:modelValue":l[13]||(l[13]=a=>o.value.method=a)},{default:t(()=>[e(A,{label:"rc4-md5",value:"rc4-md5"}),e(A,{label:"aes-256-gcm",value:"aes-256-gcm"}),e(A,{label:"chacha20-ietf-poly1305",value:"chacha20-ietf-poly1305"})]),_:1},8,["modelValue"])]),_:1}),e(m,{label:"管理员权限"},{default:t(()=>[e(ce,{modelValue:o.value.is_admin,"onUpdate:modelValue":l[14]||(l[14]=a=>o.value.is_admin=a),disabled:r.value.id===M.value},null,8,["modelValue","disabled"]),r.value.id===M.value?(B(),T("div",Qe," 不能修改自己的管理员权限 ")):O("",!0)]),_:1})]),_:1},8,["model"])):O("",!0)]),_:1},8,["modelValue","title"])])}}}),Je=Ne(Ge,[["__scopeId","data-v-5b1f9a85"]]);if(!G())throw new Error("User not authenticated or not admin");if(!require("@/shared/utils/auth").auth.isAdmin())throw alert("需要管理员权限才能访问此页面"),window.location.href="/index.html",new Error("Admin privileges required");const N=Ue(Je);N.use(Ee);for(const[S,U]of Object.entries(Me))N.component(S,U);Fe();N.mount("#app");
