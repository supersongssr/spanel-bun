var T=(k,o,v)=>new Promise((C,g)=>{var R=f=>{try{w(v.next(f))}catch(x){g(x)}},D=f=>{try{w(v.throw(f))}catch(x){g(x)}},w=f=>f.done?C(f.value):Promise.resolve(f.value).then(R,D);w((v=v.apply(k,o)).next())});import"../modulepreload-polyfill-B5Qt9EMX.js";import{v as $,ax as ss,r as V,c as L,l as es,ab as i,B as M,z as A,C as t,D as a,E as s,Q as m,u as l,R as d,y as ts,O as j,at as as}from"../vue-vendor-k0iSlyGv.js";/* empty css               */import{u as H,a as os,s as ls,w as ns,c as O,r as ds,b as is,t as rs,d as cs,E as P,i as us,e as _s}from"../element-plus-0NBP0_0Z.js";import{g as fs,a as ps,b as N,f as ms,c as vs,d as hs,e as b,h as S,i as U,j as bs,s as gs}from"../router-guard-Df7N2WPS.js";import{_ as ws}from"../_plugin-vue_export-helper-DlAUqK2U.js";const ys={class:"dashboard-container"},xs={class:"header-content"},ks={class:"user-info"},Cs={class:"user-name"},Ds={class:"card-header"},Es={class:"card-content"},Bs={class:"info-item"},Ns={class:"value"},Rs={class:"info-item"},Ts={class:"value"},Vs={class:"info-item"},As={class:"card-header"},Fs={class:"card-content"},Is={class:"balance-display"},zs={class:"balance-amount"},Ls={class:"info-item"},Ms={class:"value"},js={key:0,class:"info-item"},Hs={class:"card-header"},Os={class:"card-content"},Ps={class:"info-item"},Ss={class:"value"},Us={class:"info-item"},Qs={class:"value"},qs={class:"info-item"},Gs={class:"value"},Js={class:"card-header"},Ks={class:"card-content actions"},Ws={class:"card-header"},Xs={class:"traffic-overview"},Ys={class:"progress-section"},Zs={class:"progress-header"},$s={class:"progress-value"},se={class:"traffic-item"},ee={class:"traffic-value"},te={class:"traffic-item"},ae={class:"traffic-value"},oe={class:"traffic-item"},le={class:"traffic-value total-used"},ne={class:"traffic-item"},de={class:"traffic-value remaining"},ie={class:"traffic-limit"},re={class:"limit-value"},ce={class:"card-header"},ue=$({__name:"Dashboard",setup(k){ss();const o=V({}),v=V([]),C=V(!1),g=L(()=>{var c;return fs(((c=o.value.account)==null?void 0:c.expire_in)||null)}),R=L(()=>{var e;const c=((e=o.value.traffic)==null?void 0:e.used_percent)||0;return ps(c)}),D=()=>T(this,null,function*(){var c;try{C.value=!0;const e=yield S(U.api.user.info.get());o.value=e}catch(e){console.error("Failed to fetch user data:",e),P.error(e.message||"获取用户信息失败"),(c=e.message)!=null&&c.includes("Authentication")&&N.logout()}finally{C.value=!1}}),w=()=>T(this,null,function*(){try{const c=yield S(U.api.user.traffic.get());v.value=c.daily_history||[]}catch(c){console.error("Failed to fetch traffic history:",c)}}),f=()=>{D(),w(),P.success("数据已刷新")},x=()=>{N.logout()},Q=()=>{window.location.href="/user/nodes.html"};return es(()=>{if(!N.isLoggedIn()){N.logout();return}D(),w()}),(c,e)=>{const p=i("el-icon"),q=i("el-dropdown-item"),G=i("el-dropdown-menu"),J=i("el-dropdown"),K=i("el-header"),I=i("el-tag"),y=i("el-card"),_=i("el-col"),z=i("el-button"),E=i("el-row"),W=i("el-progress"),X=i("el-divider"),B=i("el-table-column"),Y=i("el-table"),Z=i("el-main");return A(),M("div",ys,[t(K,{class:"dashboard-header"},{default:a(()=>[s("div",xs,[e[1]||(e[1]=s("h1",{class:"title"},"用户仪表盘",-1)),s("div",ks,[t(J,null,{dropdown:a(()=>[t(G,null,{default:a(()=>[t(q,{onClick:x},{default:a(()=>[t(p,null,{default:a(()=>[t(l(ls))]),_:1}),e[0]||(e[0]=m(" 退出登录 ",-1))]),_:1})]),_:1})]),default:a(()=>{var n;return[s("span",Cs,[t(p,null,{default:a(()=>[t(l(H))]),_:1}),m(" "+d(((n=o.value.user)==null?void 0:n.user_name)||"Loading...")+" ",1),t(p,{class:"el-icon--right"},{default:a(()=>[t(l(os))]),_:1})])]}),_:1})])])]),_:1}),t(Z,{class:"dashboard-main"},{default:a(()=>[t(E,{gutter:20,class:"info-cards"},{default:a(()=>[t(_,{xs:24,sm:12,md:6},{default:a(()=>[t(y,{class:"info-card"},{header:a(()=>[s("div",Ds,[t(p,null,{default:a(()=>[t(l(H))]),_:1}),e[2]||(e[2]=s("span",null,"用户信息",-1))])]),default:a(()=>{var n,u;return[s("div",Es,[s("div",Bs,[e[3]||(e[3]=s("span",{class:"label"},"用户名:",-1)),s("span",Ns,d(((n=o.value.user)==null?void 0:n.user_name)||"-"),1)]),s("div",Rs,[e[4]||(e[4]=s("span",{class:"label"},"邮箱:",-1)),s("span",Ts,d(((u=o.value.user)==null?void 0:u.email)||"-"),1)]),s("div",Vs,[e[5]||(e[5]=s("span",{class:"label"},"等级:",-1)),t(I,{size:"small"},{default:a(()=>{var h,r;return[m(d((r=(h=o.value.user)==null?void 0:h.class)!=null?r:0),1)]}),_:1})])])]}),_:1})]),_:1}),t(_,{xs:24,sm:12,md:6},{default:a(()=>[t(y,{class:"info-card"},{header:a(()=>[s("div",As,[t(p,null,{default:a(()=>[t(l(ns))]),_:1}),e[6]||(e[6]=s("span",null,"账户余额",-1))])]),default:a(()=>{var n,u;return[s("div",Fs,[s("div",Is,[s("span",zs,d(l(ms)(((n=o.value.account)==null?void 0:n.money)||0)),1)]),s("div",Ls,[e[7]||(e[7]=s("span",{class:"label"},"过期时间:",-1)),s("span",Ms,d(l(vs)(((u=o.value.account)==null?void 0:u.expire_in)||"")),1)]),g.value!==null?(A(),M("div",js,[e[8]||(e[8]=s("span",{class:"label"},"剩余天数:",-1)),t(I,{type:g.value<7?"danger":"success",size:"small"},{default:a(()=>[m(d(g.value)+" 天 ",1)]),_:1},8,["type"])])):j("",!0)])]}),_:1})]),_:1}),t(_,{xs:24,sm:12,md:6},{default:a(()=>[t(y,{class:"info-card"},{header:a(()=>[s("div",Hs,[t(p,null,{default:a(()=>[t(l(O))]),_:1}),e[9]||(e[9]=s("span",null,"连接配置",-1))])]),default:a(()=>{var n,u,h;return[s("div",Os,[s("div",Ps,[e[10]||(e[10]=s("span",{class:"label"},"加密方式:",-1)),s("span",Ss,d(((n=o.value.account)==null?void 0:n.method)||"-"),1)]),s("div",Us,[e[11]||(e[11]=s("span",{class:"label"},"协议:",-1)),s("span",Qs,d(((u=o.value.account)==null?void 0:u.protocol)||"-"),1)]),s("div",qs,[e[12]||(e[12]=s("span",{class:"label"},"混淆:",-1)),s("span",Gs,d(((h=o.value.account)==null?void 0:h.obfs)||"-"),1)])])]}),_:1})]),_:1}),t(_,{xs:24,sm:12,md:6},{default:a(()=>[t(y,{class:"info-card"},{header:a(()=>[s("div",Js,[t(p,null,{default:a(()=>[t(l(is))]),_:1}),e[13]||(e[13]=s("span",null,"快速操作",-1))])]),default:a(()=>[s("div",Ks,[t(z,{type:"primary",onClick:Q,icon:l(O)},{default:a(()=>[...e[14]||(e[14]=[m(" 节点列表 ",-1)])]),_:1},8,["icon"]),t(z,{onClick:f,icon:l(ds)},{default:a(()=>[...e[15]||(e[15]=[m(" 刷新数据 ",-1)])]),_:1},8,["icon"])])]),_:1})]),_:1})]),_:1}),t(E,{gutter:20,class:"traffic-section"},{default:a(()=>[t(_,{span:24},{default:a(()=>[t(y,null,{header:a(()=>[s("div",Ws,[t(p,null,{default:a(()=>[t(l(rs))]),_:1}),e[16]||(e[16]=s("span",null,"流量统计",-1))])]),default:a(()=>{var n,u,h;return[s("div",Xs,[s("div",Ys,[s("div",Zs,[e[17]||(e[17]=s("span",{class:"progress-label"},"总流量使用",-1)),s("span",$s,d(l(hs)(((n=o.value.traffic)==null?void 0:n.used_percent)||0)),1)]),t(W,{percentage:parseFloat((((u=o.value.traffic)==null?void 0:u.used_percent)||0).toFixed(2)),color:R.value,"stroke-width":20},null,8,["percentage","color"])]),t(E,{gutter:20,class:"traffic-details"},{default:a(()=>[t(_,{xs:24,sm:12,md:6},{default:a(()=>{var r;return[s("div",se,[e[18]||(e[18]=s("div",{class:"traffic-label"},"已用上传",-1)),s("div",ee,d(l(b)(((r=o.value.traffic)==null?void 0:r.upload)||0)),1)])]}),_:1}),t(_,{xs:24,sm:12,md:6},{default:a(()=>{var r;return[s("div",te,[e[19]||(e[19]=s("div",{class:"traffic-label"},"已用下载",-1)),s("div",ae,d(l(b)(((r=o.value.traffic)==null?void 0:r.download)||0)),1)])]}),_:1}),t(_,{xs:24,sm:12,md:6},{default:a(()=>{var r;return[s("div",oe,[e[20]||(e[20]=s("div",{class:"traffic-label"},"总已用流量",-1)),s("div",le,d(l(b)(((r=o.value.traffic)==null?void 0:r.total_used)||0)),1)])]}),_:1}),t(_,{xs:24,sm:12,md:6},{default:a(()=>{var r;return[s("div",ne,[e[21]||(e[21]=s("div",{class:"traffic-label"},"剩余流量",-1)),s("div",de,d(l(b)(((r=o.value.traffic)==null?void 0:r.available)||0)),1)])]}),_:1})]),_:1}),t(X),s("div",ie,[e[22]||(e[22]=s("span",{class:"limit-label"},"流量上限:",-1)),s("span",re,d(l(b)(((h=o.value.traffic)==null?void 0:h.transfer_enable)||0)),1)])])]}),_:1})]),_:1})]),_:1}),v.value.length>0?(A(),ts(E,{key:0,gutter:20,class:"traffic-history-section"},{default:a(()=>[t(_,{span:24},{default:a(()=>[t(y,null,{header:a(()=>[s("div",ce,[t(p,null,{default:a(()=>[t(l(cs))]),_:1}),e[23]||(e[23]=s("span",null,"最近 7 天流量记录",-1))])]),default:a(()=>[t(Y,{data:v.value,stripe:""},{default:a(()=>[t(B,{prop:"date",label:"日期",width:"180"}),t(B,{prop:"upload",label:"上传"},{default:a(({row:n})=>[m(d(l(b)(n.upload)),1)]),_:1}),t(B,{prop:"download",label:"下载"},{default:a(({row:n})=>[m(d(l(b)(n.download)),1)]),_:1}),t(B,{prop:"total",label:"总计"},{default:a(({row:n})=>[m(d(l(b)(n.total)),1)]),_:1})]),_:1},8,["data"])]),_:1})]),_:1})]),_:1})):j("",!0)]),_:1})])}}}),_e=ws(ue,[["__scopeId","data-v-10308e63"]]);if(!bs())throw new Error("User not authenticated");const F=as(_e);F.use(us);for(const[k,o]of Object.entries(_s))F.component(k,o);gs();F.mount("#app");
